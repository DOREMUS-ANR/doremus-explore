<div class="bearing" *ngIf="!expression"></div>
<error-msg *ngIf="error"></error-msg>

<loading *ngIf="querying"></loading>

<article *ngIf="expression" class="expression-detail">
  <section class="overview">
    <div [ngStyle]="{'background-image': 'url('+overviewPic+')'}" class="bg"></div>
    <div class="overview-cont">
      <div class="title-cont">
        <p class="composer">
          <a [routerLink]="['/artist/', expression.composerId[i]]" *ngFor="let composer of expression.composer; let i = index">{{composer}}</a>
        </p>
        <h1 class="title" *ngIf="expression.title">{{expression.title[0]}}</h1>
        <p class="other-title">
          {{expression.title.slice(1).join(' | ')}}
        </p>

        <div class="note">
          <p *ngFor="let note of expression.note">{{note}}</p>
        </div>

      </div>

      <div class="info-cont">
        <div class="sources">
          <a href='{{expression.sourceLink || "http://www.radiofrance.fr/"}}' rel="external" target="blank" class="source">
            <img src='{{getSource(expression.source).img}}' alt='{{getSource(expression.source).label}}' title="data from {{getSource(expression.source).label}}" />
          </a>
        </div>
        <div class="info-card">

          <div *ngIf="expression.key">
            <label>Key</label>
            <span *ngFor="let key of expression.key; let i = index">
              <a [routerLink]="['/expression']" [queryParams]="{ key: expression.keyURI[i]}">{{key}}</a>
            </span>
          </div>
          <div *ngIf="expression.genre">
            <label>Genre</label>
            <span *ngFor="let genre of expression.genre; let i = index">
              <a [routerLink]="['/expression']" [queryParams]="{ genre: expression.genreURI[i]}">{{genre}}</a>
            </span>
          </div>
          <div *ngIf="expression.opus">
            <label>Opus</label>
            <span>{{expression.opus}}</span>
          </div>
          <div *ngIf="expression.catalogue">
            <label>Catalog</label>
            <span>{{expression.catalogue}}</span>
          </div>
          <div *ngIf="expression.castingURI">
            <label>Casting</label>
            <ul style="list-style-type: none; margin: 0; padding: 0">
              <li *ngFor="let mop of expression.mop; let i = index" class="instr icon-right-dir">
                <a [routerLink]="['/expression']" [queryParams]="{ mop: expression.mopURI[i]}">{{mop}}</a>
              </li>
            </ul>
          </div>

        </div>
      </div>
    </div>
  </section>

  <div class="main info">
    <section>
      <timeline *ngIf="dates && dates.length > 0" [dates]="this.dates"></timeline>

      <section class="realisations" *ngFor="let evtGroup of expression.events | keys">
        <h2><strong>{{evtGroup.value.length}}</strong>{{class2Label(evtGroup.key)}}</h2>
        <div class="card-list">
          <summary *ngFor="let evt of evtGroup.value" [entity]="evt | summary: evt.class" [eclass]="evt.class"></summary>
        </div>
      </section>
    </section>

    <section class="recommendation-cont">
      <recommendation [seed]="expression.uri"></recommendation>
    </section>
  </div>
</article>
